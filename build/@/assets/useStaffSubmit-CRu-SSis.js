import{d as p}from"./Layout-JsXqKSFR.js";import{r as n,A as F,S as K,e as V,b as q}from"./index-njudL7fz.js";import{u as z}from"./index.esm-2x07zYBF.js";import{A as S}from"./AdminServices-Dj0irfRq.js";import{n as A,a as C}from"./toast-DX8d8eRH.js";const Q=m=>{const{state:j}=n.useContext(F),{adminInfo:D}=j,{isDrawerOpen:d,closeDrawer:l,setIsUpdate:h,lang:w}=n.useContext(K),[y,f]=n.useState(""),[u,Y]=n.useState(p(new Date).format("YYYY-MM-DD")),[i,x]=n.useState(w||"en"),[E,I]=n.useState({}),[L,c]=n.useState(!1),M=V(),{register:U,handleSubmit:k,setValue:a,clearErrors:r,formState:{errors:v}}=z(),O=t=>{for(const o in t)t[o].trim()===""&&delete t[o];return t},R=async t=>{var o,e;try{c(!0);const s={name:O({[i]:t.name}),email:t.email,password:t.password,phone:t.phone,role:t.role,joiningDate:u||p(new Date).format("YYYY-MM-DD"),image:y,lang:i};if(m){const g=await S.updateStaff(m,s);h(!0),c(!1),A(g.message),l()}else{const g=await S.addStaff(s);h(!0),c(!1),A(g.message),l()}}catch(s){C(s?(e=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:e.message:s==null?void 0:s.message),c(!1),l()}},b=async()=>{var t,o;try{const e=await S.getStaffById(m,{email:D.email});e&&(I(e),a("name",e.name[i||"en"]),a("email",e.email),a("password"),a("phone",e.phone),a("role",e.role),Y(p(e.joiningData).format("YYYY-MM-DD")),f(e.image))}catch(e){C(e?(o=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:o.message:e==null?void 0:e.message)}},B=t=>{x(t),Object.keys(E).length>0&&a("name",E.name[t||"en"])};return n.useEffect(()=>{if(!d){I({}),a("name"),a("email"),a("password"),a("phone"),a("role"),a("joiningDate"),f(""),r("name"),r("email"),r("password"),r("phone"),r("role"),r("joiningDate"),f(""),x(w),a("language",i);return}m&&b()},[m,a,d,D.email,r]),n.useEffect(()=>{M.pathname==="/edit-profile"&&q.get("adminInfo")&&b()},[M.pathname,a]),{register:U,handleSubmit:k,onSubmit:R,language:i,errors:v,setImageUrl:f,imageUrl:y,selectedDate:u,setSelectedDate:Y,isSubmitting:L,handleSelectLanguage:B}};export{Q as u};
